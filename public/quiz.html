<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M'C | Quiz</title>
    <link rel="stylesheet" href="./css/quiz.css">
    <link rel="icon" href="./assets/icon/favicon2.svg">
    <script src="./js/sessao.js"></script>
</head>


<body onload="validarSessao()">

    <div class="header-left">

        <h1>Maias' Cuisine <img src="./assets/icon/favicon2.svg"></h1>

        <div class="hello">
            <h3>Bem vindo de volta, <span id="b_usuario">usuário</span>!</h3>
        </div>

        <div class="btn-nav">

            <h3>Quiz</h3>

        </div>

        <div class="btn-nav-white">
            <a href="./dashboard.html">
                <h3>Painel de dados</h3>
            </a>
        </div>

        <div class="btn-nav-white">
            <a href="feed.html">
                <h3>Feed</h3>
            </a>
        </div>

        <div class="btn-logout" onclick="limparSessao()">
            <h3>Sair</h3>
        </div>

    </div>

    <div class="qt-app">
        <h1>QUIZ - COMIDAS BRASILEIRAS</h1>
        <div class="qt-quiz">
            <h2 id="qt-question">Enunciado</h2>
            <div id="qt-answer-buttons">
                <button class="qt-btn">quest 1</button>
                <button class="qt-btn">quest 2</button>
                <button class="qt-btn">quest 3</button>
                <button class="qt-btn">quest 4</button>
            </div>
            <button id="qt-next-btn">Next Quest</button>
        </div>
    </div>

</body>

</html>
<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var idUsuario = Number(sessionStorage.ID_USUARIO);

    const questions = [
        {
            question: "O “bolo de rolo” é típico de qual estado brasileiro?",
            answers: [
                { id: 3, text: "Piauí", correct: false },
                { id: 4, text: "Paraná", correct: false },
                { id: 1, text: "Paraíba", correct: false },
                { id: 2, text: "Pernambuco", correct: true }
            ]
        },
        {
            question: "Qual doce é feito com leite condensado, chocolate e granulado?",
            answers: [
                { id: 2, text: "Beijinho", correct: false },
                { id: 3, text: "Brigadeiro", correct: true },
                { id: 4, text: "Quindim", correct: false },
                { id: 1, text: "Pé-de-moleque", correct: false }
            ]
        },
        {
            question: "O que geralmente acompanha o arroz e feijão no prato feito brasileiro?",
            answers: [
                { id: 4, text: "Molho barbecue", correct: false },
                { id: 1, text: "Batata frita", correct: false },
                { id: 2, text: "Farofa", correct: true },
                { id: 3, text: "Sushi", correct: false }
            ]
        },
        {
            question: "O que é 'moqueca'?",
            answers: [
                { id: 2, text: "Doce de leite", correct: false },
                { id: 3, text: "Churrasco de porco", correct: false },
                { id: 1, text: "Ensopado de peixe", correct: true },
                { id: 4, text: "Sopa de mandioca", correct: false }
            ]
        },
        {
            question: "Qual prato típico leva arroz, pequi e frango?",
            answers: [
                { id: 1, text: "Arroz carreteiro", correct: false },
                { id: 2, text: "Galinhada", correct: true },
                { id: 3, text: "Baião de dois", correct: false },
                { id: 4, text: "Vaca atolada", correct: false }
            ]
        },
        {
            question: "Qual desses pratos exige que as folhas sejam cozidas por 7 dias para eliminar toxinas?",
            answers: [
                { id: 4, text: "Tacacá", correct: false },
                { id: 3, text: "Vatapá", correct: false },
                { id: 1, text: "Maniçoba", correct: true },
                { id: 2, text: "Feijoada", correct: false }
            ]
        },
        {
            question: "O que é o 'pinhão', muito consumido na região Sul?",
            answers: [
                { id: 3, text: "Folha de chá", correct: false },
                { id: 4, text: "Raiz comestível", correct: false },
                { id: 2, text: "Semente da araucária", correct: true },
                { id: 1, text: "Fruta do cerrado", correct: false }
            ]
        },
        {
            question: "Qual estado é conhecido pelo uso do tucupi e jambu na culinária?",
            answers: [
                { id: 4, text: "Rio Grande do Sul", correct: false },
                { id: 1, text: "Bahia", correct: false },
                { id: 3, text: "Minas Gerais", correct: false },
                { id: 2, text: "Pará", correct: true }
            ]
        },
        {
            question: "A maniçoba é um prato típico de qual região?",
            answers: [
                { id: 4, text: "Sudeste", correct: false },
                { id: 1, text: "Sul", correct: false },
                { id: 3, text: "Norte", correct: true },
                { id: 2, text: "Centro-Oeste", correct: false }
            ]
        },
        {
            question: "Qual é o prato típico brasileiro feito com feijão-preto e várias carnes?",
            answers: [
                { id: 4, text: "Sarapatel", correct: false },
                { id: 2, text: "Dobradinha", correct: false },
                { id: 1, text: "Feijoada", correct: true },
                { id: 3, text: "Moqueca", correct: false }
            ]
        }
    ];

    const questionElement = document.getElementById("qt-question");
    const answerButtons = document.getElementById("qt-answer-buttons");
    const nextButton = document.getElementById("qt-next-btn");

    let currentQuestionIndex = 0;
    let score = 0;

    function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        nextButton.innerHTML = "Próxima";
        showQuestion();
    }

    function resetState() {
        nextButton.style.display = "none";
        while (answerButtons.firstChild) {
            answerButtons.removeChild(answerButtons.firstChild);
        }
    }

    function showQuestion() {
        resetState();
        let currentQuestion = questions[currentQuestionIndex];
        let questionNo = currentQuestionIndex + 1;
        questionElement.innerHTML = questionNo + ". " + currentQuestion.question;

        currentQuestion.answers.forEach((answer) => {
            const button = document.createElement("button");
            button.innerHTML = answer.text;
            button.dataset.id = answer.id;
            button.classList.add("qt-btn");
            button.addEventListener("click", selectAnswer);
            answerButtons.appendChild(button);
        });
    }

    function selectAnswer(e) {
        answers = questions[currentQuestionIndex].answers;
        const correctAnswer = answers.filter((answer) => answer.correct == true)[0];
        const selectBtn = e.target;
        const isCorrect = selectBtn.dataset.id == correctAnswer.id;
        if (isCorrect) {
            selectBtn.classList.add("correct");
            score++;
        } else {
            selectBtn.classList.add("incorrect");
        }
        Array.from(answerButtons.children).forEach((button) => {
            button.disabled = true;
        });
        nextButton.style.display = "block";
    }

    function showScore() {
        resetState();
        questionElement.innerHTML = `Você acertou ${score} de ${questions.length} perguntas!`
        nextButton.innerHTML = "Tentar novamente";
        nextButton.style.display = "block";
    }

    function handleNextButton() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            showQuestion();
        } else {
            showScore();
        }
    }

    nextButton.addEventListener("click", () => {
        if (currentQuestionIndex < questions.length) {
            handleNextButton();
        } else {
            startQuiz();
        }
    });

    startQuiz();

</script>